<!DOCTYPE html>
<html>
<head>
    <title>Diagnostic Planificare - Anghelus Raluca</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
        .log { background: #fff; padding: 15px; border: 1px solid #ccc; margin-top: 10px; white-space: pre-wrap; font-family: monospace; }
        .status { font-weight: bold; color: blue; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Diagnostic Script - Angheluș Raluca (Ianuarie 2026)</h1>
    <div id="status" class="status">Se conectează la Supabase...</div>
    
    <h3>1. Date brute din tabelul PONTAJ:</h3>
    <div id="log-brut" class="log">Se încarcă...</div>

    <h3>2. Rezultat după filtrarea pentru clasa "5A":</h3>
    <div id="log-filtrat" class="log">Se încarcă...</div>

    <script>
        const URL_S = 'https://aexjrbdgajurxzngfkpx.supabase.co';
        const KEY_S = 'sb_publishable_KPV__0BA9z4EvRl5eqC0FQ_hmBLOLYv';
        const supabaseClient = supabase.createClient(URL_S, KEY_S);

        async function runTest() {
            const status = document.getElementById('status');
            const logBrut = document.getElementById('log-brut');
            const logFiltrat = document.getElementById('log-filtrat');

            try {
                // Pasul 1: Interogăm baza de date pentru Ianuarie 2026
                status.innerText = "Pasul 1: Descarc datele din pontaj...";
                const { data, error } = await supabaseClient
                    .from('pontaj_detaliat')
                    .select('*')
                    .match({ expert: 'Angheluș Raluca', luna: 'Ianuarie', an: '2026' });

                if (error) throw error;

                logBrut.innerText = JSON.stringify(data, null, 2);

                // Pasul 2: Simulăm filtrarea pentru clasa 5A
                status.innerText = "Pasul 2: Filtrez pentru clasa 5A...";
                
                // Aceasta este logica pe care ar trebui să o aibă codul tău pentru a fi corect:
                const clasaCautata = "5A";
                const filtered = data.filter(row => {
                    const listaClase = row.clase_grupe ? row.clase_grupe.split(',') : [];
                    return listaClase.includes(clasaCautata);
                });

                logFiltrat.innerText = `S-au găsit ${filtered.length} zile pentru clasa 5A:\n\n` + 
                                     JSON.stringify(filtered, null, 2);

                if (filtered.length > 1) {
                    status.innerHTML = `<span class="success">TEST REUȘIT: Baza de date returnează ${filtered.length} rânduri. Problema este în modul în care 'planificare.html' randează tabelul.</span>`;
                } else if (filtered.length === 1) {
                    status.innerHTML = `<span class="error">TEST EȘUAT: Baza de date returnează doar 1 rând. Verifică dacă în Pontaj ai pus clasa 5A în mai multe zile diferite!</span>`;
                } else {
                    status.innerHTML = `<span class="error">NU S-A GĂSIT NIMIC: Verifică dacă numele expertului sau luna sunt scrise corect în baza de date.</span>`;
                }

            } catch (err) {
                status.className = "error";
                status.innerText = "Eroare: " + err.message;
            }
        }

        runTest();
    </script>
</body>
</html>